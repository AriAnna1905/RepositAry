<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokédex Globale by ARI</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f6f8fc;
            margin: 20px;
        }

        /* --- TITOLO CON POKEBALL ROTANTE --- */
        .title {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            color: #ef5350;
        }

        .pokeball-icon {
            width: 40px;
            height: 40px;
            animation: rotateBall 2s linear infinite;
        }

        @keyframes rotateBall {
            from { transform: rotate(0deg); }
            to   { transform: rotate(360deg); }
        }

        h1 {
            text-align: center;
            color: #ef5350;
        }

        /* --- SCATOLA POKEDEX --- */
        .pokedex-shell {
            background: #ef5350;
            padding: 20px;
            border-radius: 20px;
            border: 4px solid #b71c1c;
            box-shadow: 0 0 20px rgba(0,0,0,0.25);
            position: relative;
            margin-top: 20px;
        }

        .pokedex-shell::before,
        .pokedex-shell::after {
            content: "";
            width: 18px;
            height: 18px;
            background: #c62828;
            border: 3px solid #7f0000;
            border-radius: 50%;
            position: absolute;
        }

        .pokedex-shell::before {
            top: 10px;
            left: 10px;
        }

        .pokedex-shell::after {
            top: 10px;
            right: 10px;
        }

        /* --- CONTROLLI --- */
        .controls, .search-bar {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
        }

        .search-bar input {
            width: 250px;
            padding: 8px;
            border-radius: 8px;
            border: none;
            outline: none;
            font-size: 16px;
        }

        select {
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        /* --- TABELLA --- */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #ddd;
        }

        /* --- HIGHLIGHT STILE POKEDEX --- */
        tr {
            position: relative;
            transition: background 0.25s ease, transform 0.25s ease;
        }

        tr:not(.detail-row):hover {
            background: #ffebee;
            transform: translateX(6px);
            cursor: pointer;
        }

        tr::before {
            content: "";
            position: absolute;
            left: 0;
            top: 0;
            width: 0;
            height: 100%;
            background: #ef5350;
            transition: width 0.25s ease;
        }

        tr:hover::before {
            width: 6px;
        }

        .pokemon-image {
            width: 60px;
        }

        /* --- TYPE CHIPS --- */
        .type-chip {
            display: inline-block;
            min-width: 70px;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 999px;
            color: white;
            font-size: 12px;
            text-transform: uppercase;
            text-align: center;
        }

        .type-fire    { background: #EE8130; }
        .type-water   { background: #6390F0; }
        .type-grass   { background: #7AC74C; }
        .type-electric{ background: #F7D02C; color: #444; }
        .type-ice     { background: #96D9D6; }
        .type-fighting{ background: #C22E28; }
        .type-poison  { background: #A33EA1; }
        .type-ground  { background: #E2BF65; color: #444; }
        .type-flying  { background: #A98FF3; }
        .type-psychic { background: #F95587; }
        .type-bug     { background: #A6B91A; }
        .type-rock    { background: #B6A136; }
        .type-ghost   { background: #735797; }
        .type-dragon  { background: #6F35FC; }
        .type-dark    { background: #705746; }
        .type-steel   { background: #B7B7CE; color: #444; }
        .type-fairy   { background: #D685AD; }
        .type-normal  { background: #A8A77A; }

        /* --- PANNELLO DETTAGLI LCD --- */
        .pokedex-panel {
            background: #1a1a1a;
            border: 3px solid #333;
            border-radius: 12px;
            padding: 20px;
            color: #00ff9c;
            font-family: "Courier New", monospace;
            text-shadow: 0 0 4px #00ff9c;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
            transition: max-height 0.35s ease, opacity 0.35s ease;
            background-image: 
                linear-gradient(rgba(0,255,100,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,255,100,0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .pokedex-panel.open {
            max-height: 500px;
            opacity: 1;
        }

        .pokedex-content {
            text-align: center;
        }

        .pokedex-content img {
            width: 150px;
            display: block;
            margin: 0 auto 10px auto;
        }

        .pokedex-content ul {
            display: inline-block;
            text-align: left;
            margin: 0 auto;
            padding-left: 20px;
        }
    </style>
</head>

<body>

    <h1 class="title">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png"
             alt="Pokéball" class="pokeball-icon">
        Pokédex
    </h1>

    <!-- SUONO -->
    <audio id="pokedexSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

    <!-- BARRA DI RICERCA -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Cerca Pokémon..." oninput="filterPokemon()">
        <select id="genSelector" onchange="changeGeneration()">
            <option value="1">Gen 1</option>
            <option value="2">Gen 2</option>
            <option value="3">Gen 3</option>
            <option value="4">Gen 4</option>
            <option value="5">Gen 5</option>
            <option value="6">Gen 6</option>
            <option value="7">Gen 7</option>
            <option value="8">Gen 8</option>
            <option value="9">Gen 9</option>
        </select>
    </div>

    <!-- CONTROLLI -->
    <div class="controls">
        <button onclick="loadpokemon(0)">Prima Pagina</button>
        <button onclick="loadpokemon(currentOffset - 20)">Precedente</button>
        <button onclick="loadpokemon(currentOffset + 20)">Successiva</button>
    </div>

    <div id="caricamento" style="display:none; text-align:center; font-size:18px;">
        ⏳ Caricamento Pokémon...
    </div>

    <div class="pokedex-shell">
        <table id="pokemonTable">
            <thead>
                <tr>
                    <th>Immagine</th>
                    <th>Nome</th>
                    <th>ID</th>
                    <th>Tipo</th>
                    <th>Altezza</th>
                    <th>Peso</th>
                </tr>
            </thead>
            <tbody id="pokemonTableBody"></tbody>
        </table>
    </div>

    <div id="pagination">
        <div id="pageInfo"></div>
    </div>

    <script>
        let currentOffset = 0;
        let currentPokemonList = [];
        let openDetailRow = null;

        const genRanges = {
            1: [1, 151],
            2: [152, 251],
            3: [252, 386],
            4: [387, 493],
            5: [494, 649],
            6: [650, 721],
            7: [722, 809],
            8: [810, 905],
            9: [906, 1025]
        };

        document.addEventListener("DOMContentLoaded", () => {
            loadpokemon(0);
        });

        async function loadpokemon(offset = 0) {
            if (offset < 0) offset = 0;

            try {
                document.getElementById("caricamento").style.display = "block";
                document.getElementById("pokemonTableBody").innerHTML = "";

                const response = await fetch(`https://pokeapi.co/api/v2/pokemon?limit=20&offset=${offset}`);
                const data = await response.json();

                currentOffset = offset;

                const pokemonPromises = data.results.map(async (pokemon, index) => {
                    const detailResponse = await fetch(pokemon.url);
                    const detail = await detailResponse.json();
                    return { ...detail, listIndex: index };
                });

                currentPokemonList = await Promise.all(pokemonPromises);

                displayPokemonTable(currentPokemonList);
                updatePagination(data, offset);

            } catch (error) {
                console.error(error);
            } finally {
                document.getElementById("caricamento").style.display = "none";
            }
        }

        function renderTypeChips(types) {
            return types.map(t => {
                const typeName = t.type.name;
                return `<span class="type-chip type-${typeName}">${typeName}</span>`;
            }).join(" ");
        }

        function displayPokemonTable(pokemonList) {
            const tbody = document.getElementById("pokemonTableBody");
            tbody.innerHTML = "";

            pokemonList.forEach((pokemon) => {
                const row = document.createElement("tr");

                row.innerHTML = `
                    <td><img src="${pokemon.sprites.front_default}" class="pokemon-image"></td>
                    <td>${pokemon.name}</td>
                    <td>${pokemon.id.toString().padStart(3, '0')}</td>
                    <td>${renderTypeChips(pokemon.types)}</td>
                    <td>${pokemon.height / 10} m</td>
                    <td>${pokemon.weight / 10} kg</td>
                `;

                row.onclick = () => toggleDetails(pokemon, row);
                tbody.appendChild(row);
            });
        }

        function toggleDetails(pokemon, row) {
            const sound = document.getElementById("pokedexSound");
            sound.currentTime = 0;
            sound.play();

            if (openDetailRow) {
                const previousRow = openDetailRow;
                const panel = previousRow.querySelector(".pokedex-panel");
                panel.classList.remove("open");

                setTimeout(() => {
                    previousRow.remove();
                }, 350);

                openDetailRow = null;

                if (previousRow === row.nextSibling) return;
            }

            const detailRow = document.createElement("tr");
            detailRow.classList.add("detail-row");

            const detailCell = document.createElement("td");
            detailCell.colSpan = 6;

            detailCell.innerHTML = `
                <div class="pokedex-panel">
                    <div class="pokedex-content">
                        <h2>${pokemon.name} (#${pokemon.id.toString().padStart(3, '0')})</h2>
                        <img src="${pokemon.sprites.other['official-artwork'].front_default}">
                        <p><strong>Tipo:</strong> ${renderTypeChips(pokemon.types)}</p>
                        <p><strong>Altezza:</strong> ${pokemon.height / 10} m</p>
                        <p><strong>Peso:</strong> ${pokemon.weight / 10} kg</p>
                        <h3>Statistiche</h3>
                        <ul>
                            ${pokemon.stats.map(s => `<li>${s.stat.name.replace("-", " ")}: ${s.base_stat}</li>`).join("")}
                        </ul>
                    </div>
                </div>
            `;

            detailRow.appendChild(detailCell);
            row.insertAdjacentElement("afterend", detailRow);

            requestAnimationFrame(() => {
                detailCell.querySelector(".pokedex-panel").classList.add("open");
            });

            openDetailRow = detailRow;
        }

        function updatePagination(data, offset) {
            const pageInfo = document.getElementById("pageInfo");
            const currentPage = Math.floor(offset / 20) + 1;
            const totalPages = Math.ceil(data.count / 20);

            pageInfo.textContent = `Pagina ${currentPage} di ${totalPages} (${data.count} Pokémon totali)`;
        }

        function filterPokemon() {
            const query = document.getElementById("searchInput").value.toLowerCase();
            const filtered = currentPokemonList.filter(p => p.name.includes(query));
            displayPokemonTable(filtered);
        }

        function changeGeneration() {
            const gen = document.getElementById("genSelector").value;
            const [start] = genRanges[gen];
            loadpokemon(start - 1);
        }
    </script>

</body>
</html>